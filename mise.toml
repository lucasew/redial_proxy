[tools]
go = "1.25.6"

[tasks.install]
# We build golangci-lint from source because the prebuilt binary uses an older Go version
# and fails on go.mod 1.25.1+
run = ["go mod download", "go install github.com/golangci/golangci-lint/cmd/golangci-lint@v1.64.5"]

[tasks.codegen]
run = "go mod tidy"

[tasks."lint:golangci-lint"]
run = "golangci-lint run"

[tasks.lint]
depends = ["lint:*"]

[tasks."fmt:go"]
run = "go fmt ./..."

[tasks.fmt]
depends = ["fmt:*"]

[tasks.test]
run = "go test ./..."

[tasks.build]
run = "go build -v -o build/redial_proxy ./cmd/redial_proxy"

[tasks.build-all]
run = "bash scripts/build-all.sh"

[tasks.ci]
depends = ["lint", "test"]
